#!/bin/ksh

#caseid='b40.1850.track1.2deg.wcm.007'
caseid='b40.20th.track1.2deg.wcm.007'
wadir='/data2/fischer/'$caseid'/h0'
outdir='/data3/mmills/'$caseid'/h0zm'

#year1=97
#year2=177

year1=1915
year2=1941

mkdir -p $outdir

#ncfiles=$wadir'*cam2.h0.*.nc'

year=$year1
while [[ $year -le $year2 ]];do

  if [[ year -lt 10 ]];then
    yearstr='000'$year
  elif [[ year -lt 100 ]];then
    yearstr='00'$year
  elif [[ year -lt 1000 ]];then
    yearstr='0'$year
  else
    yearstr=$year
  fi

  month=1

  while [[ month -le 12 ]];do

    if [[ month -lt 10 ]];then
      monstr='0'$month
    else
      monstr=$month
    fi

    oldfile=$wadir'/'$caseid'.cam2.h0.'$yearstr'-'$monstr'.nc'

    if [[ -e $oldfile ]];then
      echo $oldfile
    else
      echo 'missing file: '$oldfile
      exit
    fi
    newfile=`echo $oldfile | sed 's/h0/h0zm/g' | sed 's/data2/data3/g' | sed 's/fischer/mmills/g'`
    echo $newfile

    if [[ ! -e $newfile ]] then
      echo "ncwa -alon -O "$oldfile" "$newfile
      ncwa -alon -O $oldfile $newfile
    fi
    ls -sh $oldfile
    ls -sh $newfile

    (( month+=1 ))
    
  done
  (( year+=1 ))
done
